<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¾Œå°ç™»å…¥ï½œé—œéµå´—ä½ç•«åƒç®¡ç†</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; line-height: 1.6; }
    h2 { margin-top: 2rem; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    textarea, input[type="text"] { width: 100%; padding: 0.5rem; margin-top: 0.2rem; }
    button { margin-top: 0.5rem; padding: 0.4rem 0.8rem; }
    fieldset { border: 1px solid #ccc; padding: 1rem; margin-top: 1rem; position: relative; }
    legend { font-weight: bold; }
    .block { margin-bottom: 1rem; }
    .small-note { font-size: 0.9em; color: #666; margin-top: 0.2rem; }
    .delete-btn { position: absolute; top: 5px; right: 10px; color: red; cursor: pointer; background: none; border: none; }
    .section-block { border: 1px solid #ccc; padding: 1rem; margin-top: 2rem; background: #fafafa; }
    .section-block h3 { margin-top: 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 0.5rem; text-align: left; }
    .role-list { border-top: 1px dashed #ccc; margin-top: 2rem; padding-top: 1rem; }
    .role-item { margin: 0.5rem 0; }
    .role-item button { margin-left: 0.5rem; }
    .json-buttons { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <h1>ğŸ” å¾Œå°ç™»å…¥</h1>
  <input type="password" id="passwordInput" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" />
  <button onclick="checkPassword()">ç™»å…¥</button>

  <div id="adminContent" style="display:none;">
    <h2>ğŸ¯ é—œéµè·ä½è¨­å®šè¡¨å–®</h2>
    <form id="roleForm">
      <label>è·ä½åç¨±</label>
      <input type="text" id="roleName" required />
      <label>å·¥ä½œèªªæ˜æ›¸</label>
      <textarea id="jobDescription" rows="3"></textarea>

      <h3>ğŸ“Œ ç¡¬æŒ‡æ¨™</h3>
      <fieldset>
        <legend>å­¸æ­·</legend>
        <label>æè¿°</label>
        <textarea id="eduDesc"></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="eduScores" rows="5"></textarea>
        <div class="small-note">è«‹è¼¸å…¥æ¯è¡Œä¸€ç­†æè¿°ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ1åˆ†ï½5åˆ†ã€æ¨™ç¤º</div>
      </fieldset>

      <fieldset>
        <legend>ç¶“æ­·</legend>
        <label>æè¿°</label>
        <textarea id="expDesc"></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="expScores" rows="5"></textarea>
        <div class="small-note">è«‹è¼¸å…¥æ¯è¡Œä¸€ç­†æè¿°ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ1åˆ†ï½5åˆ†ã€æ¨™ç¤º</div>
      </fieldset>

      <fieldset>
        <legend>å°ˆæ¥­æŠ€èƒ½</legend>
        <label>æè¿°</label>
        <textarea id="skillDesc"></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="skillScores" rows="5"></textarea>
        <div class="small-note">è«‹è¼¸å…¥æ¯è¡Œä¸€ç­†æè¿°ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ1åˆ†ï½5åˆ†ã€æ¨™ç¤º</div>
      </fieldset>

      <h3>ğŸŒŸ è»Ÿå¯¦åŠ›ï¼ˆæœ€å¤šäº”é …ï¼‰</h3>
      <div id="softContainer"></div>
      <button type="button" onclick="addSection('soft')">ï¼‹æ–°å¢è»Ÿå¯¦åŠ›é …ç›®</button>

      <h3>ğŸ’¡ äººæ ¼ç‰¹è³ªï¼ˆæœ€å¤šäº”é …ï¼‰</h3>
      <div id="traitContainer"></div>
      <button type="button" onclick="addSection('trait')">ï¼‹æ–°å¢äººæ ¼ç‰¹è³ªé …ç›®</button>

      <h3>âš ï¸ æ‡‰é¿å…çš„äººæ ¼ç‰¹è³ªï¼ˆæœ€å¤šä¸‰é …ï¼‰</h3>
      <div id="avoidContainer"></div>
      <button type="button" onclick="addSection('avoid')">ï¼‹æ–°å¢æ‡‰é¿å…é …ç›®</button>

      <br/><br/>
      <button type="submit">ğŸ“¥ æ–°å¢è·ä½ç•«åƒ</button>
      <button type="button" onclick="clearForm()" style="margin-left:1rem;color:red;">ğŸ—‘ï¸ æ¸…é™¤ç›®å‰è¡¨å–®</button>
    </form>

    <div class="role-list">
      <div class="json-buttons">
        <h3 style="margin: 0;">ğŸ—‚ï¸ å·²æ–°å¢è·ä½æ¸…å–®</h3>
        <input type="file" id="jsonImport" accept=".json" style="display:none" onchange="handleImport(this.files[0])">
        <button onclick="document.getElementById('jsonImport').click()">ğŸ“¥ åŒ¯å…¥ JSON</button>
        <button onclick="exportJSON()">ğŸ“¤ åŒ¯å‡º JSON</button>
      </div>
      <ul id="roleList"></ul>
    </div>

    <div id="displayArea" style="margin-top:2rem;"></div>

<script>
  const correctPassword = "demo_admin";
  let roles = [];

  function checkPassword() {
    if (document.getElementById("passwordInput").value === correctPassword) {
      document.getElementById("adminContent").style.display = "block";
      const stored = localStorage.getItem("roles");
      roles = stored ? JSON.parse(stored) : [];
      updateRoleList();
    } else {
      alert("å¯†ç¢¼éŒ¯èª¤ï¼");
    }
  }

  const limits = { soft: 5, trait: 5, avoid: 3 };
  const counters = { soft: 0, trait: 0, avoid: 0 };

  function addSection(type) {
    if (counters[type] >= limits[type]) return alert(`æœ€å¤šåªèƒ½æ–°å¢ ${limits[type]} é …`);
    const container = document.getElementById(type + "Container");
    const div = document.createElement("div");
    div.classList.add("block");
    const index = counters[type] + 1;
    div.innerHTML = `
      <fieldset>
        <legend>é …ç›® ${index}</legend>
        <button class="delete-btn" onclick="this.parentElement.parentElement.remove();event.preventDefault();counters['${type}']--;">âœ–</button>
        <label>åç¨±</label>
        <input type="text" name="${type}Name" />
        <label>æè¿°</label>
        <textarea name="${type}Desc"></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea name="${type}Scores" rows="5"></textarea>
        <div class="small-note">è«‹è¼¸å…¥æ¯è¡Œä¸€ç­†æè¿°ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ1åˆ†ï½5åˆ†ã€æ¨™ç¤º</div>
      </fieldset>
    `;
    container.appendChild(div);
    counters[type]++;
  }

  function clearForm() {
    document.getElementById("roleForm").reset();
    document.getElementById("softContainer").innerHTML = '';
    document.getElementById("traitContainer").innerHTML = '';
    document.getElementById("avoidContainer").innerHTML = '';
    counters.soft = counters.trait = counters.avoid = 0;
  }

  function applyScoreLabels(lines) {
    return lines.map((line, i) => `${i + 1}åˆ†ï¼š${line.trim()}`);
  }

  function collectBlocks(type) {
    const names = document.getElementsByName(`${type}Name`);
    const descs = document.getElementsByName(`${type}Desc`);
    const scores = document.getElementsByName(`${type}Scores`);
    const arr = [];
    for (let i = 0; i < names.length; i++) {
      arr.push({
        name: names[i].value.trim(),
        description: descs[i].value.trim(),
        scores: applyScoreLabels(scores[i].value.trim().split("\n"))
      });
    }
    return arr;
  }

  function generateTable(title, description, scores) {
    let rows = scores.map(score => `<tr><td colspan="2">${score}</td></tr>`).join('');
    return `
      <div class="section-block">
        <h3>${title}</h3>
        <p><strong>æè¿°ï¼š</strong>${description}</p>
        <table>${rows}</table>
      </div>
    `;
  }

  function displayRole(index) {
    const role = roles[index];
    let html = `
      <div class="section-block">
        <h2>ğŸ“Œ è·ä½åç¨±ï¼š${role.role}</h2>
        <p><strong>å·¥ä½œèªªæ˜ï¼š</strong>${role.jobDescription}</p>
      </div>
      ${generateTable("å­¸æ­·", role.hardCriteria.education.description, role.hardCriteria.education.scores)}
      ${generateTable("ç¶“æ­·", role.hardCriteria.experience.description, role.hardCriteria.experience.scores)}
      ${generateTable("å°ˆæ¥­æŠ€èƒ½", role.hardCriteria.skills.description, role.hardCriteria.skills.scores)}
    `;

    role.softSkills.forEach(s => {
      html += generateTable(`ğŸŒŸ è»Ÿå¯¦åŠ›ï½œ${s.name}`, s.description, s.scores);
    });
    role.personalityTraits.forEach(s => {
      html += generateTable(`ğŸ’¡ äººæ ¼ç‰¹è³ªï½œ${s.name}`, s.description, s.scores);
    });
    role.avoidTraits.forEach(s => {
      html += generateTable(`âš ï¸ æ‡‰é¿å…äººæ ¼ç‰¹è³ªï½œ${s.name}`, s.description, s.scores);
    });

    document.getElementById("displayArea").innerHTML = html;
  }

  function updateRoleList() {
    const list = document.getElementById("roleList");
    list.innerHTML = "";
    roles.forEach((r, i) => {
      const li = document.createElement("li");
      li.classList.add("role-item");
      li.innerHTML = `
        ğŸ”˜ <button onclick="displayRole(${i})">${r.role}</button>
        <button onclick="window.open('pdf.html?index=${i}', '_blank')">ğŸ“„ é è¦½èˆ‡åŒ¯å‡º</button>
        <button onclick="deleteRole(${i})" style="color:red;">ğŸ—‘ï¸ åˆªé™¤</button>
      `;
      list.appendChild(li);
    });
    localStorage.setItem("roles", JSON.stringify(roles));
  }

  function deleteRole(index) {
    if (confirm("ç¢ºå®šè¦åˆªé™¤æ­¤è·ä½ï¼Ÿ")) {
      roles.splice(index, 1);
      document.getElementById("displayArea").innerHTML = "";
      updateRoleList();
    }
  }

  function exportJSON() {
    const blob = new Blob([JSON.stringify(roles, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "roles_backup.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  function handleImport(file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const data = JSON.parse(e.target.result);
        if (!Array.isArray(data)) throw new Error("æ ¼å¼éŒ¯èª¤ï¼");
        roles = data;
        updateRoleList();
        document.getElementById("displayArea").innerHTML = "";
        alert("âœ… åŒ¯å…¥æˆåŠŸï¼");
      } catch (err) {
        alert("âŒ åŒ¯å…¥å¤±æ•—ï¼š" + err.message);
      }
    };
    reader.readAsText(file);
  }

  document.getElementById("roleForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const data = {
      role: document.getElementById("roleName").value.trim(),
      jobDescription: document.getElementById("jobDescription").value.trim(),
      hardCriteria: {
        education: {
          description: document.getElementById("eduDesc").value.trim(),
          scores: applyScoreLabels(document.getElementById("eduScores").value.trim().split("\n"))
        },
        experience: {
          description: document.getElementById("expDesc").value.trim(),
          scores: applyScoreLabels(document.getElementById("expScores").value.trim().split("\n"))
        },
        skills: {
          description: document.getElementById("skillDesc").value.trim(),
          scores: applyScoreLabels(document.getElementById("skillScores").value.trim().split("\n"))
        }
      },
      softSkills: collectBlocks("soft"),
      personalityTraits: collectBlocks("trait"),
      avoidTraits: collectBlocks("avoid")
    };

    roles.push(data);
    updateRoleList();
    displayRole(roles.length - 1);
    clearForm();
    alert("âœ… è·ä½ç•«åƒå·²æ–°å¢ï¼");
  });
</script>
</body>
</html>
