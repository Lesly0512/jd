<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¾Œå°ç™»å…¥ï½œé—œéµå´—ä½ç•«åƒç®¡ç†</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; line-height: 1.6; }
    h2 { margin-top: 2rem; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    textarea, input[type="text"] { width: 100%; padding: 0.5rem; margin-top: 0.2rem; }
    button { margin-top: 0.5rem; padding: 0.4rem 0.8rem; }
    fieldset { border: 1px solid #ccc; padding: 1rem; margin-top: 1rem; position: relative; }
    legend { font-weight: bold; }
    .block { margin-bottom: 1rem; }
    .small-note { font-size: 0.9em; color: #666; margin-top: 0.2rem; }
    .delete-btn { position: absolute; top: 5px; right: 10px; color: red; cursor: pointer; background: none; border: none; }
    .section-block { border: 1px solid #ccc; padding: 1rem; margin-top: 2rem; background: #fafafa; }
    .section-block h3 { margin-top: 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 0.5rem; text-align: left; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <h1>ğŸ” å¾Œå°ç™»å…¥</h1>
  <input type="password" id="passwordInput" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" />
  <button onclick="checkPassword()">ç™»å…¥</button>

  <div id="adminContent" style="display:none;">
    <h2>ğŸ¯ é—œéµè·ä½è¨­å®šè¡¨å–®</h2>
    <form id="roleForm">
      <label>è·ä½åç¨±</label>
      <input type="text" id="roleName" required />
      <label>å·¥ä½œèªªæ˜æ›¸</label>
      <textarea id="jobDescription" rows="3"></textarea>

      <h3>ğŸ“Œ ç¡¬æŒ‡æ¨™</h3>
      <fieldset>
        <legend>å­¸æ­·</legend>
        <label>æè¿°</label>
        <textarea id="eduDesc"></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="eduScores" rows="5"></textarea>
        <div class="small-note">è«‹è¼¸å…¥æ¯è¡Œä¸€ç­†æè¿°ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ1åˆ†ï½5åˆ†ã€æ¨™ç¤º</div>
      </fieldset>

      <fieldset>
        <legend>ç¶“æ­·</legend>
        <label>æè¿°</label>
        <textarea id="expDesc"></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="expScores" rows="5"></textarea>
        <div class="small-note">è«‹è¼¸å…¥æ¯è¡Œä¸€ç­†æè¿°ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ1åˆ†ï½5åˆ†ã€æ¨™ç¤º</div>
      </fieldset>

      <fieldset>
        <legend>å°ˆæ¥­æŠ€èƒ½</legend>
        <label>æè¿°</label>
        <textarea id="skillDesc"></textarea>
        <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
        <textarea id="skillScores" rows="5"></textarea>
        <div class="small-note">è«‹è¼¸å…¥æ¯è¡Œä¸€ç­†æè¿°ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ1åˆ†ï½5åˆ†ã€æ¨™ç¤º</div>
      </fieldset>

      <h3>ğŸŒŸ è»Ÿå¯¦åŠ›ï¼ˆæœ€å¤šäº”é …ï¼‰</h3>
      <div id="softContainer"></div>
      <button type="button" onclick="addSection('soft')">ï¼‹æ–°å¢è»Ÿå¯¦åŠ›é …ç›®</button>

      <h3>ğŸ’¡ äººæ ¼ç‰¹è³ªï¼ˆæœ€å¤šäº”é …ï¼‰</h3>
      <div id="traitContainer"></div>
      <button type="button" onclick="addSection('trait')">ï¼‹æ–°å¢äººæ ¼ç‰¹è³ªé …ç›®</button>

      <h3>âš ï¸ æ‡‰é¿å…çš„äººæ ¼ç‰¹è³ªï¼ˆæœ€å¤šä¸‰é …ï¼‰</h3>
      <div id="avoidContainer"></div>
      <button type="button" onclick="addSection('avoid')">ï¼‹æ–°å¢æ‡‰é¿å…é …ç›®</button>

      <br/><br/>
      <button type="submit">ğŸ“¥ å„²å­˜è·ä½è³‡æ–™</button>
      <button type="button" onclick="clearForm()" style="margin-left:1rem;color:red;">ğŸ—‘ï¸ åˆªé™¤æ•´ç­†è·ä½</button>
    </form>

    <div id="displayArea"></div>
    <div style="margin-top: 1rem;">
      <button onclick="downloadPDF()">ğŸ“„ ä¸‹è¼‰ PDF</button>
    </div>
  </div>

  <script>
    const correctPassword = "demo_admin";
    function checkPassword() {
      if (document.getElementById("passwordInput").value === correctPassword) {
        document.getElementById("adminContent").style.display = "block";
      } else {
        alert("å¯†ç¢¼éŒ¯èª¤ï¼");
      }
    }

    const limits = { soft: 5, trait: 5, avoid: 3 };
    const counters = { soft: 0, trait: 0, avoid: 0 };

    function addSection(type) {
      if (counters[type] >= limits[type]) return alert(`æœ€å¤šåªèƒ½æ–°å¢ ${limits[type]} é …`);
      const container = document.getElementById(type + "Container");
      const div = document.createElement("div");
      div.classList.add("block");
      const index = counters[type] + 1;
      div.innerHTML = `
        <fieldset>
          <legend>é …ç›® ${index}</legend>
          <button class="delete-btn" onclick="this.parentElement.parentElement.remove();event.preventDefault();counters['${type}']--;">âœ–</button>
          <label>åç¨±</label>
          <input type="text" name="${type}Name" />
          <label>æè¿°</label>
          <textarea name="${type}Desc"></textarea>
          <label>1ï½5 åˆ†è©•åˆ†æè¿°</label>
          <textarea name="${type}Scores" rows="5"></textarea>
          <div class="small-note">è«‹è¼¸å…¥æ¯è¡Œä¸€ç­†æè¿°ï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œ1åˆ†ï½5åˆ†ã€æ¨™ç¤º</div>
        </fieldset>
      `;
      container.appendChild(div);
      counters[type]++;
    }

    function clearForm() {
      if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸ")) {
        document.getElementById("roleForm").reset();
        document.getElementById("softContainer").innerHTML = '';
        document.getElementById("traitContainer").innerHTML = '';
        document.getElementById("avoidContainer").innerHTML = '';
        document.getElementById("displayArea").innerHTML = '';
        counters.soft = counters.trait = counters.avoid = 0;
      }
    }

    function applyScoreLabels(lines) {
      return lines.map((line, i) => `${i + 1}åˆ†ï¼š${line.trim()}`);
    }

    function collectBlocks(type) {
      const names = document.getElementsByName(`${type}Name`);
      const descs = document.getElementsByName(`${type}Desc`);
      const scores = document.getElementsByName(`${type}Scores`);
      const arr = [];
      for (let i = 0; i < names.length; i++) {
        arr.push({
          name: names[i].value.trim(),
          description: descs[i].value.trim(),
          scores: applyScoreLabels(scores[i].value.trim().split("\n"))
        });
      }
      return arr;
    }

    function generateTable(title, description, scores) {
      let rows = scores.map(score => `<tr><td colspan="2">${score}</td></tr>`).join('');
      return `
        <div class="section-block">
          <h3>${title}</h3>
          <p><strong>æè¿°ï¼š</strong>${description}</p>
          <table>${rows}</table>
        </div>
      `;
    }

    document.getElementById("roleForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const display = document.getElementById("displayArea");
      display.innerHTML = "";

      const role = document.getElementById("roleName").value.trim();
      const jobDescription = document.getElementById("jobDescription").value.trim();

      const eduDesc = document.getElementById("eduDesc").value.trim();
      const eduScores = applyScoreLabels(document.getElementById("eduScores").value.trim().split("\n"));
      const expDesc = document.getElementById("expDesc").value.trim();
      const expScores = applyScoreLabels(document.getElementById("expScores").value.trim().split("\n"));
      const skillDesc = document.getElementById("skillDesc").value.trim();
      const skillScores = applyScoreLabels(document.getElementById("skillScores").value.trim().split("\n"));

      let html = `
        <div class="section-block">
          <h2>ğŸ“Œ è·ä½åç¨±ï¼š${role}</h2>
          <p><strong>å·¥ä½œèªªæ˜ï¼š</strong>${jobDescription}</p>
        </div>
        ${generateTable("å­¸æ­·", eduDesc, eduScores)}
        ${generateTable("ç¶“æ­·", expDesc, expScores)}
        ${generateTable("å°ˆæ¥­æŠ€èƒ½", skillDesc, skillScores)}
      `;

      const sections = [
        { type: "soft", title: "ğŸŒŸ è»Ÿå¯¦åŠ›" },
        { type: "trait", title: "ğŸ’¡ äººæ ¼ç‰¹è³ª" },
        { type: "avoid", title: "âš ï¸ æ‡‰é¿å…äººæ ¼ç‰¹è³ª" }
      ];

      sections.forEach(section => {
        const blocks = collectBlocks(section.type);
        blocks.forEach(b => {
          html += generateTable(`${section.title}ï½œ${b.name}`, b.description, b.scores);
        });
      });

      display.innerHTML = html;
    });

    function downloadPDF() {
      const element = document.getElementById("displayArea");
      const opt = {
        margin: 0.5,
        filename: 'è·ä½ç•«åƒ.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }
  </script>
</body>
</html>
