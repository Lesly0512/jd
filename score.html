<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>評分頁面｜職位畫像適配</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f9f9f9; }
    h1, h2 { margin-bottom: 0.5rem; }
    .section { margin-bottom: 2rem; background: #fff; padding: 1rem; border-radius: 6px; border: 1px solid #ddd; }
    .section h3 { margin-top: 0; }
    .rating-row { margin: 1rem 0; }
    .rating-label { font-weight: bold; display: block; margin-bottom: 0.3rem; }
    .score-options input { margin-right: 0.3rem; }
    button { padding: 0.5rem 1rem; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>📝 職位畫像適配評分</h1>
  <div id="jobInfo" class="section"></div>
  <form id="scoreForm"></form>
  <div id="chartArea" style="margin-top: 3rem;"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const params = new URLSearchParams(window.location.search);
  const index = parseInt(params.get("index"), 10);
  const roles = JSON.parse(localStorage.getItem("roles") || "[]");
  const role = roles[index];

  if (!role) {
    document.body.innerHTML = "<p>找不到職位資料，請從首頁重新選擇。</p>";
    throw new Error("No role data.");
  }

  document.getElementById("jobInfo").innerHTML = `
    <h2>${role.role}</h2>
    <p>${role.jobDescription}</p>
  `;

  const form = document.getElementById("scoreForm");
  const allSections = [
    { label: "學歷", key: "education", data: role.hardCriteria.education },
    { label: "經歷", key: "experience", data: role.hardCriteria.experience },
    { label: "專業技能", key: "skills", data: role.hardCriteria.skills },
    ...role.softSkills.map((s, i) => ({ label: `軟實力｜${s.name}`, key: `soft${i}`, data: s })),
    ...role.personalityTraits.map((s, i) => ({ label: `人格特質｜${s.name}`, key: `trait${i}`, data: s })),
    ...role.avoidTraits.map((s, i) => ({ label: `⚠️應避免｜${s.name}`, key: `avoid${i}`, data: s }))
  ];

  allSections.forEach((section, i) => {
    const div = document.createElement("div");
    div.classList.add("section");
    div.innerHTML = `
      <h3>${section.label}</h3>
      <p>${section.data.description}</p>
      <div class="rating-row">
        <label class="rating-label">請為此項目評分：</label>
        <div class="score-options">
          ${[1,2,3,4,5].map(n => `
            <label><input type="radio" name="${section.key}" value="${n}" required> ${n}</label>
          `).join(" ")}
        </div>
      </div>
    `;
    form.appendChild(div);
  });

  const submitBtn = document.createElement("button");
  submitBtn.type = "submit";
  submitBtn.innerText = "📊 完成評分並產出雷達圖";
  form.appendChild(submitBtn);

  form.addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(form);
    const labels = allSections.map(s => s.label);
    const scores = allSections.map(s => parseInt(formData.get(s.key), 10));
    const avgScores = allSections.map(s => 3); // 模擬平均值（固定 3 分）

    const ctx = document.createElement("canvas");
    document.getElementById("chartArea").innerHTML = "<h2>📈 適配度雷達圖</h2>";
    document.getElementById("chartArea").appendChild(ctx);

    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: labels,
        datasets: [
          {
            label: '個人評分',
            data: scores,
            borderWidth: 2,
            fill: true
          },
          {
            label: '平均標準（模擬）',
            data: avgScores,
            borderWidth: 2,
            borderDash: [5,5],
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          r: {
            min: 0,
            max: 5,
            ticks: { stepSize: 1 }
          }
        }
      }
    });
  });
</script>
</body>
</html>
