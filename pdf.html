<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>PDF 預覽與匯出</title>
  <style>
    body { font-family: "Noto Sans TC", sans-serif; padding: 2rem; line-height: 1.6; }
    h1, h2, h3 { margin: 1rem 0 0.5rem; }
    .section-block { margin-top: 2rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    td { border: 1px solid #ccc; padding: 0.5rem; }
    .meta { margin-bottom: 1.5rem; color: #666; font-size: 0.9rem; }
    .download-btn { margin-top: 1rem; padding: 0.4rem 0.8rem; }
  </style>
</head>
<body>
  <h1 id="pdfTitle">職位畫像 PDF 預覽</h1>
  <div class="meta" id="timestamp"></div>

  <div id="pdfContent"></div>

  <button class="download-btn" onclick="window.print()">📄 下載 PDF</button>

<script>
function renderPDFPage() {
  const params = new URLSearchParams(window.location.search);
  const index = parseInt(params.get("index"), 10);
  const raw = localStorage.getItem("roles");
  const roles = raw ? JSON.parse(raw) : [];

  if (isNaN(index) || !roles[index]) {
    document.getElementById("pdfContent").innerHTML = "<p>查無職位資料。</p>";
    return;
  }

  const role = roles[index];
  document.getElementById("pdfTitle").innerText = "職位畫像｜" + role.role;
  document.getElementById("timestamp").innerText = "匯出日期：" + new Date().toLocaleString("zh-TW");

  let html = `
    <div class="section-block">
      <h3>📌 職位名稱：${role.role}</h3>
      <p><strong>工作說明：</strong>${role.description}</p>
    </div>
    ${generateTable("🎓 學歷", role.hard.edu)}
    ${generateTable("📂 經歷", role.hard.exp)}
    ${generateTable("🛠️ 專業技能", role.hard.skill)}
  `;

  role.soft.forEach(s => {
    html += generateTable(`🌟 軟實力｜${s.title}`, s);
  });
  role.trait.forEach(s => {
    html += generateTable(`💡 人格特質｜${s.title}`, s);
  });
  role.avoid.forEach(s => {
    html += generateTable(`⚠️ 應避免特質｜${s.title}`, s);
  });

  document.getElementById("pdfContent").innerHTML = html;
}

function generateTable(title, item) {
  const rows = item.scores.map(s => `<tr><td colspan="2">${s}</td></tr>`).join('');
  return `
    <div class="section-block">
      <h3>${title}</h3>
      <p><strong>描述：</strong>${item.desc}</p>
      <table>${rows}</table>
    </div>
  `;
}

window.onload = renderPDFPage;
</script>
</body>
</html>
