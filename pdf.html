<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“„ è·ä½ç•«åƒé è¦½èˆ‡åŒ¯å‡º</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f5f5f5; line-height: 1.6; }
    #protected { display: none; }
    .section-block { background: #fff; padding: 1rem; margin-bottom: 1.5rem; border-radius: 6px; border: 1px solid #ccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; }
    .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .topbar h2 { margin: 0; }
    button { padding: 0.5rem 1rem; }
    #authBox { text-align: center; margin-top: 10vh; }
    #authBox input { padding: 0.5rem; width: 200px; margin-right: 1rem; }
  </style>
</head>
<body>
<div id="authBox">
  <h2>è«‹è¼¸å…¥å¯†ç¢¼ä»¥æŸ¥çœ‹è·ä½ç•«åƒ</h2>
  <input type="password" id="pdfPass" placeholder="å¯†ç¢¼">
  <button onclick="unlock()">ç™»å…¥</button>
</div>

<div id="protected">
  <div class="topbar">
    <h2 id="pdfTitle">è·ä½ç•«åƒ</h2>
    <div>
      <span id="timestamp"></span>
      <button onclick="downloadPDF()">ğŸ“„ ä¸‹è¼‰ PDF</button>
    </div>
  </div>
  <div id="pdfContent"></div>
</div>

<script>
  const correctPassword = "demo_admin";

  function unlock() {
    const input = document.getElementById("pdfPass").value;
    if (input === correctPassword) {
      document.getElementById("authBox").style.display = "none";
      document.getElementById("protected").style.display = "block";
      renderPDFPage();
    } else {
      alert("å¯†ç¢¼éŒ¯èª¤ï¼");
    }
  }

  function renderPDFPage() {
    const params = new URLSearchParams(window.location.search);
    const index = parseInt(params.get("index"), 10);
    const raw = localStorage.getItem("roles");
    const roles = raw ? JSON.parse(raw) : [];

    if (isNaN(index) || !roles[index]) {
      document.getElementById("pdfContent").innerHTML = "<p>æŸ¥ç„¡è·ä½è³‡æ–™ã€‚</p>";
      return;
    }

    const role = roles[index];
    document.getElementById("pdfTitle").innerText = "è·ä½ç•«åƒï½œ" + role.role;
    document.getElementById("timestamp").innerText = "åŒ¯å‡ºæ—¥æœŸï¼š" + new Date().toLocaleString("zh-TW");

    let html = `
      <div class="section-block">
        <h3>ğŸ“Œ è·ä½åç¨±ï¼š${role.role}</h3>
        <p><strong>å·¥ä½œèªªæ˜ï¼š</strong>${role.jobDescription}</p>
      </div>
      ${generateTable("å­¸æ­·", role.hardCriteria.education)}
      ${generateTable("ç¶“æ­·", role.hardCriteria.experience)}
      ${generateTable("å°ˆæ¥­æŠ€èƒ½", role.hardCriteria.skills)}
    `;

    role.softSkills.forEach(s => {
      html += generateTable(`ğŸŒŸ è»Ÿå¯¦åŠ›ï½œ${s.name}`, s);
    });
    role.personalityTraits.forEach(s => {
      html += generateTable(`ğŸ’¡ äººæ ¼ç‰¹è³ªï½œ${s.name}`, s);
    });
    role.avoidTraits.forEach(s => {
      html += generateTable(`âš ï¸ æ‡‰é¿å…äººæ ¼ç‰¹è³ªï½œ${s.name}`, s);
    });

    document.getElementById("pdfContent").innerHTML = html;
  }

  function generateTable(title, item) {
    const rows = item.scores.map(s => `<tr><td colspan="2">${s}</td></tr>`).join('');
    return `
      <div class="section-block">
        <h3>${title}</h3>
        <p><strong>æè¿°ï¼š</strong>${item.description}</p>
        <table>${rows}</table>
      </div>
    `;
  }

  function downloadPDF() {
    const element = document.getElementById("pdfContent");
    const title = document.getElementById("pdfTitle").innerText.replace("è·ä½ç•«åƒï½œ", "");
    const opt = {
      margin: 0.5,
      filename: `è·ä½ç•«åƒ_${title}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(element).save();
  }
</script>
</body>
</html>
